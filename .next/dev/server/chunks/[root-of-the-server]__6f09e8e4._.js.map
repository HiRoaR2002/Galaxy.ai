{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ASUS/Desktop/Galaxy.ai/src/app/api/run-llm/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { z } from \"zod\";\r\nimport { GoogleGenerativeAI, Part } from \"@google/generative-ai\";\r\n\r\nconst RequestSchema = z.object({\r\n  model: z.enum([\"gemini-1.5-flash\", \"gemini-1.5-pro\", \"gemini-2.5-flash\"]),\r\n  systemPrompt: z.string().optional(),\r\n  userMessage: z.string(),\r\n  images: z.array(z.string()).optional(), // Expecting base64 data URLs\r\n});\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const body = await req.json();\r\n    const validatedData = RequestSchema.safeParse(body);\r\n\r\n    if (!validatedData.success) {\r\n      return NextResponse.json(\r\n        { error: \"Invalid request data\", details: validatedData.error.issues },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    const { model, systemPrompt, userMessage, images } = validatedData.data;\r\n    \r\n    // Server-side environment check for safety\r\n    const apiKey = process.env.GEMINI_API_KEY;\r\n    if (!apiKey) {\r\n      return NextResponse.json(\r\n        { error: \"Server Configuration Error: Missing GEMINI_API_KEY\" },\r\n        { status: 500 }\r\n      );\r\n    }\r\n\r\n    const genAI = new GoogleGenerativeAI(apiKey);\r\n    const geminiModel = genAI.getGenerativeModel({ \r\n        model: model,\r\n        systemInstruction: systemPrompt ? { role: \"system\", parts: [{ text: systemPrompt }] } : undefined\r\n    });\r\n\r\n    const promptParts: Part[] = [{ text: userMessage }];\r\n\r\n    if (images && images.length > 0) {\r\n      images.forEach((imgDataUrl) => {\r\n        // Extract base64 part\r\n        // Format: data:image/png;base64,.....\r\n        const matches = imgDataUrl.match(/^data:(.+);base64,(.+)$/);\r\n        if (matches) {\r\n            promptParts.push({\r\n                inlineData: {\r\n                    mimeType: matches[1],\r\n                    data: matches[2]\r\n                }\r\n            });\r\n        }\r\n      });\r\n    }\r\n\r\n    const result = await geminiModel.generateContent(promptParts);\r\n    const response = await result.response;\r\n    const text = response.text();\r\n\r\n    return NextResponse.json({ text });\r\n\r\n  } catch (error: any) {\r\n    console.error(\"Gemini API Error:\", error);\r\n    return NextResponse.json(\r\n      { error: error.message || \"An error occurred during generation\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,MAAM,gBAAgB,oLAAC,CAAC,MAAM,CAAC;IAC7B,OAAO,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAoB;QAAkB;KAAmB;IACxE,cAAc,oLAAC,CAAC,MAAM,GAAG,QAAQ;IACjC,aAAa,oLAAC,CAAC,MAAM;IACrB,QAAQ,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM,IAAI,QAAQ;AACtC;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,gBAAgB,cAAc,SAAS,CAAC;QAE9C,IAAI,CAAC,cAAc,OAAO,EAAE;YAC1B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAAwB,SAAS,cAAc,KAAK,CAAC,MAAM;YAAC,GACrE;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,EAAE,KAAK,EAAE,YAAY,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,cAAc,IAAI;QAEvE,2CAA2C;QAC3C,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAqD,GAC9D;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,QAAQ,IAAI,sLAAkB,CAAC;QACrC,MAAM,cAAc,MAAM,kBAAkB,CAAC;YACzC,OAAO;YACP,mBAAmB,eAAe;gBAAE,MAAM;gBAAU,OAAO;oBAAC;wBAAE,MAAM;oBAAa;iBAAE;YAAC,IAAI;QAC5F;QAEA,MAAM,cAAsB;YAAC;gBAAE,MAAM;YAAY;SAAE;QAEnD,IAAI,UAAU,OAAO,MAAM,GAAG,GAAG;YAC/B,OAAO,OAAO,CAAC,CAAC;gBACd,sBAAsB;gBACtB,sCAAsC;gBACtC,MAAM,UAAU,WAAW,KAAK,CAAC;gBACjC,IAAI,SAAS;oBACT,YAAY,IAAI,CAAC;wBACb,YAAY;4BACR,UAAU,OAAO,CAAC,EAAE;4BACpB,MAAM,OAAO,CAAC,EAAE;wBACpB;oBACJ;gBACJ;YACF;QACF;QAEA,MAAM,SAAS,MAAM,YAAY,eAAe,CAAC;QACjD,MAAM,WAAW,MAAM,OAAO,QAAQ;QACtC,MAAM,OAAO,SAAS,IAAI;QAE1B,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK;IAElC,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qBAAqB;QACnC,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO,MAAM,OAAO,IAAI;QAAsC,GAChE;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}